---
layout: default
---

<style>
/* * {
  box-sizing: border-box;
}

body {
  width: 100vw;
  height: 100vh;
  overflow: auto;
}

body {
  padding: 2em 2em 2em 17em;
  font-size: 16px;
  line-height: 1.6;
  font-family: 'Roboto', sans-serif;
} */

.toc {
  position: fixed;
  left: 3em;
  top: 5em;
  padding: 1em;
  width: 14em;
  line-height: 2;
}

.toc ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.toc ul ul {
  padding-left: 2em;
}

.toc li a {
  display: inline-block;
  color: #aaa;
  text-decoration: none;
  transition: all 0.3s cubic-bezier(0.230, 1.000, 0.320, 1.000);
}

.toc li.visible > a {
  color: #111;
  transform: translate(5px);
}

.toc-marker {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
}

.toc-marker path {
  transition: all 0.3s ease;
}

.contents {
  padding: 1em;
  max-width: 800px;
  font-size: 1.2em;
  font-family: 'Frank Ruhl Libre', sans-serif;
}

.contents img {
  max-width: 100%;
}

.contents .code-block {
  white-space: pre;
  overflow: auto;
  max-width: 100%;
}

.contents .code-block code {
  display: block;
  background-color: #f9f9f9;
  padding: 10px;
}

.contents .code-inline {
  background-color: #f9f9f9;
  padding: 4px;
}

.contents h2,
.contents h3 {
  padding-top: 1em;
}

@media screen and (max-width: 1200px) {
  body {
    font-size: 14px;
  }
}
</style>

<div class="toc">
  {% include toc.html html=content %}
  <svg class="toc-marker" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
    <path stroke="#444" stroke-width="3" fill="transparent" stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" stroke-linejoin="round" transform="translate(-0.5, -0.5)" />
  </svg>
</div>

<script>
  var toc = document.querySelector('.toc');
  var tocPath = document.querySelector('.toc-marker path');
  var tocItems;
  // Factor of screen size that the element must cross
  // before it's considered visible
  var TOP_MARGIN = 0.1,
      BOTTOM_MARGIN = 0.2;
  var pathLength;
  var lastPathStart,
      lastPathEnd;

  window.addEventListener('resize', drawPath, false);
  window.addEventListener('scroll', sync, false);

  console.log('DOMContentLoaded');
  console.log(toc);

  drawPath();
  
  function drawPath() {
    
    tocItems = [].slice.call( toc.querySelectorAll( 'li' ) );
  
    // Cache element references and measurements
    tocItems = tocItems.map( function( item ) {
      var anchor = item.querySelector( 'a' );
      var target = document.getElementById( anchor.getAttribute( 'href' ).slice( 1 ) );
  
      return {
        listItem: item,
        anchor: anchor,
        target: target
      };
    } );
  
    // Remove missing targets
    tocItems = tocItems.filter( function( item ) {
      return !!item.target;
    } );
  
    var path = [];
    var pathIndent;
  
    tocItems.forEach( function( item, i ) {
  
      var x = item.anchor.offsetLeft - 5,
          y = item.anchor.offsetTop,
          height = item.anchor.offsetHeight;
  
      if( i === 0 ) {
        path.push( 'M', x, y, 'L', x, y + height );
        item.pathStart = 0;
      }
      else {
        // Draw an additional line when there's a change in
        // indent levels
        if( pathIndent !== x ) path.push( 'L', pathIndent, y );
  
        path.push( 'L', x, y );
        
        // Set the current path so that we can measure it
        tocPath.setAttribute( 'd', path.join( ' ' ) );
        item.pathStart = tocPath.getTotalLength() || 0;
        
        path.push( 'L', x, y + height );
      }
      
      pathIndent = x;
      
      tocPath.setAttribute( 'd', path.join( ' ' ) );
      item.pathEnd = tocPath.getTotalLength();
  
    } );
    
    pathLength = tocPath.getTotalLength();
    
    sync();
    
  }
  
  function sync() {
    
    var windowHeight = window.innerHeight;
    
    var pathStart = pathLength,
        pathEnd = 0;
    
    var visibleItems = 0;
    
    tocItems.forEach( function( item ) {
  
      var targetBounds = item.target.getBoundingClientRect();
      
      if( targetBounds.bottom > windowHeight * TOP_MARGIN && targetBounds.top < windowHeight * ( 1 - BOTTOM_MARGIN ) ) {
        pathStart = Math.min( item.pathStart, pathStart );
        pathEnd = Math.max( item.pathEnd, pathEnd );
        
        visibleItems += 1;
        
        item.listItem.classList.add( 'visible' );
      }
      else {
        item.listItem.classList.remove( 'visible' );
      }
      
    } );
    
    // Specify the visible path or hide the path altogether
    // if there are no visible items
    if( visibleItems > 0 && pathStart < pathEnd ) {
      if( pathStart !== lastPathStart || pathEnd !== lastPathEnd ) {
        tocPath.setAttribute( 'stroke-dashoffset', '1' );
        tocPath.setAttribute( 'stroke-dasharray', '1, '+ pathStart +', '+ ( pathEnd - pathStart ) +', ' + pathLength );
        tocPath.setAttribute( 'opacity', 1 );
      }
    }
    else {
      tocPath.setAttribute( 'opacity', 0 );
    }
    
    lastPathStart = pathStart;
    lastPathEnd = pathEnd;
  
  }
  </script>

<div class="post">
  <h1 class="post-title">{{ page.title }}</h1>
  <span class="post-date">{{ page.date | date_to_string }}</span>
  {{ content }}
</div>

{% if site.related_posts.size >= 1 %}
<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    {% for post in site.related_posts limit:3 %}
      <li>
        <h3>
          <a href="{{ site.baseurl }}{{ post.url }}">
            {{ post.title }}
            <small>{{ post.date | date_to_string }}</small>
          </a>
        </h3>
      </li>
    {% endfor %}
  </ul>
</div>
{% endif %}
